# 修复 Mini App 内嵌打开问题

## 问题

点击链接后直接跳转到新页面，而不是以内嵌方式在 Farcaster 客户端中打开。

## 解决方案

已添加必要的 Farcaster Mini App meta 标签，告诉 Farcaster 客户端这是一个 Mini App，应该以内嵌方式打开。

## 已添加的 Meta 标签

### 1. `fc:miniapp` Meta 标签（主要）

```html
<meta name="fc:miniapp" content='{"version":"1","imageUrl":"https://farcaster-neynar-score-miniapp.vercel.app/splash-screen.png","button":{"title":"Check Score Now","action":{"type":"launch_frame","name":"farcaster-neynar-score","url":"https://farcaster-neynar-score-miniapp.vercel.app/","splashImageUrl":"https://farcaster-neynar-score-miniapp.vercel.app/splash-screen-200-noalpha.png","splashBackgroundColor":"#9333ea"}}}' />
```

### 2. `fc:frame` Meta 标签（向后兼容）

```html
<meta name="fc:frame" content='{"version":"1","imageUrl":"https://farcaster-neynar-score-miniapp.vercel.app/splash-screen.png","button":{"title":"Check Score Now","action":{"type":"launch_frame","name":"farcaster-neynar-score","url":"https://farcaster-neynar-score-miniapp.vercel.app/","splashImageUrl":"https://farcaster-neynar-score-miniapp.vercel.app/splash-screen-200-noalpha.png","splashBackgroundColor":"#9333ea"}}}' />
```

### 3. Open Graph Meta 标签

```html
<meta property="og:type" content="website" />
<meta property="og:url" content="https://farcaster-neynar-score-miniapp.vercel.app/" />
<meta property="og:title" content="Neynar Score Checker - User" />
<meta property="og:description" content="Quickly view Neynar Scores, engagement metrics, and identity insights for any Farcaster user." />
<meta property="og:image" content="https://farcaster-neynar-score-miniapp.vercel.app/splash-screen.png" />
```

### 4. Twitter Card Meta 标签

```html
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:url" content="https://farcaster-neynar-score-miniapp.vercel.app/" />
<meta name="twitter:title" content="Neynar Score Checker - User" />
<meta name="twitter:description" content="Quickly view Neynar Scores, engagement metrics, and identity insights for any Farcaster user." />
<meta name="twitter:image" content="https://farcaster-neynar-score-miniapp.vercel.app/splash-screen.png" />
```

## Meta 标签说明

### `fc:miniapp` 和 `fc:frame` 标签的作用

这些 meta 标签告诉 Farcaster 客户端：
1. **这是一个 Mini App**：`action.type` 设置为 `"launch_frame"` 表示这是一个可启动的 Mini App
2. **如何显示**：提供图片、按钮标题等信息
3. **如何打开**：指定 URL 和启动画面配置

### 关键字段说明

- **`version`**: 必须为 `"1"`
- **`imageUrl`**: 在 feed 中显示的图片（3:2 比例，小于 10MB）
- **`button.title`**: 按钮上显示的文本（最多 32 字符）
- **`action.type`**: 必须为 `"launch_frame"` 才能以内嵌方式打开
- **`action.name`**: Mini App 名称
- **`action.url`**: 打开时的 URL
- **`action.splashImageUrl`**: 启动画面图片（200x200）
- **`action.splashBackgroundColor`**: 启动画面背景色

## 测试步骤

部署完成后（约 1-2 分钟），请按以下步骤测试：

### 1. 清除缓存（重要）

- **移动应用**：完全关闭 Warpcast，重新打开
- **Web 客户端**：清除浏览器缓存或使用无痕模式

### 2. 创建新的 Cast

1. 在 Warpcast 中创建一个新的 Cast
2. 包含您的 Mini App URL：
   ```
   https://farcaster-neynar-score-miniapp.vercel.app/
   ```
3. 发布 Cast

### 3. 点击链接

- 点击 Cast 中的链接
- **应该**会在 Warpcast 的内嵌视图中打开
- **不应该**跳转到浏览器新标签页

### 4. 验证内嵌模式

内嵌模式下应该看到：
- ✅ 应用显示在 Warpcast 客户端内
- ✅ 没有浏览器地址栏
- ✅ 可以使用 Farcaster SDK 功能
- ✅ 可以获取用户信息

## 如果仍然跳转到新页面

### 检查清单

1. **确认部署完成**：
   - 等待 Vercel 部署完成（1-2 分钟）
   - 访问页面，查看页面源代码，确认 meta 标签存在

2. **清除缓存**：
   - 完全关闭 Warpcast 应用
   - 重新打开
   - 或者使用无痕模式

3. **创建新的 Cast**：
   - 不要使用旧的 Cast
   - 创建新的 Cast，包含 Mini App URL

4. **检查 meta 标签**：
   - 访问：https://farcaster-neynar-score-miniapp.vercel.app/
   - 右键 → "查看页面源代码"
   - 搜索 `fc:miniapp`，确认标签存在

5. **验证 manifest**：
   - 访问：https://farcaster-neynar-score-miniapp.vercel.app/.well-known/farcaster.json
   - 确认 manifest 文件可以正常访问

## 技术说明

### 为什么需要这些 meta 标签？

Farcaster 客户端通过以下方式识别 Mini App：

1. **Manifest 文件**（`/.well-known/farcaster.json`）：
   - 定义 Mini App 的基本信息
   - 用于索引和发现

2. **Meta 标签**（页面 `<head>` 中）：
   - 告诉客户端这是一个可启动的 Mini App
   - 提供在 feed 中显示的元数据
   - 指定如何以内嵌方式打开

### 两者缺一不可

- **只有 Manifest**：Mini App 可以被索引，但点击链接可能跳转到浏览器
- **只有 Meta 标签**：可能无法被正确索引
- **两者都有**：Mini App 可以被索引，并且点击链接会在内嵌视图中打开

## 已完成的修复

✅ 添加了 `fc:miniapp` meta 标签  
✅ 添加了 `fc:frame` meta 标签（向后兼容）  
✅ 添加了 Open Graph meta 标签  
✅ 添加了 Twitter Card meta 标签  
✅ 代码已提交并推送到 GitHub  
✅ Vercel 正在自动部署  

## 下一步

1. **等待部署完成**（约 1-2 分钟）
2. **清除 Warpcast 缓存**（完全关闭并重新打开）
3. **创建新的 Cast**，包含 Mini App URL
4. **点击链接**，验证是否以内嵌方式打开

如果仍然有问题，请告诉我，我会进一步排查。
